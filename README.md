---
theme: smartblue
---
## å¼€æºä»“åº“åœ°å€ gitee

[Gitä»“åº“åœ°å€:https://gitee.com/zhanhongzhu/zhanhongzhu.git](https://gitee.com/zhanhongzhu/zhanhongzhu.git)

## åº”ç”¨åœ°å€

[windowsåº”ç”¨åœ°å€ä¸‹è½½ https://kestrel-task.cn](https://kestrel-task.cn/)

## å…·ä½“å†…å®¹

ä¹Ÿå¯ä»¥çœ‹[ğŸ‰ä½¿ç”¨Tauri+vite+koa2+mysqlå¼€å‘äº†ä¸€æ¬¾å¾…åŠæ•ˆç‡åº”ç”¨ ](https://juejin.cn/post/7383957030346326026) è¿™ç¯‡æ–‡ç« ã€‚

## ğŸ’»æŠ€æœ¯æ ˆ

*   **Tauri**: Tauriæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç°ä»£æ¡Œé¢åº”ç”¨ç¨‹åºçš„å·¥å…·ï¼Œç»“åˆäº†Rustã€Vue.jså’ŒWebæŠ€æœ¯ï¼Œæä¾›äº†å¼ºå¤§çš„è·¨å¹³å°èƒ½åŠ›ã€‚
*   **Vue3**: Vue3æ˜¯æµè¡Œçš„JavaScriptæ¡†æ¶Vue.jsçš„æœ€æ–°ç‰ˆæœ¬ï¼Œå…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€æ›´å¥½çš„TypeScriptæ”¯æŒå’Œæ›´å¤šçš„ç‰¹æ€§ã€‚
*   **Vite5**: Viteæ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ„å»ºå·¥å…·ï¼ŒVite5æ˜¯å…¶æœ€æ–°ç‰ˆæœ¬ï¼Œå…·æœ‰å¿«é€Ÿçš„å†·å¯åŠ¨ã€çƒ­æ¨¡å—æ›¿æ¢å’ŒåŸç”ŸESæ¨¡å—æ”¯æŒã€‚
*   **Koa2**: Koa2æ˜¯ä¸€ä¸ªåŸºäºNode.jsçš„è½»é‡çº§Webæ¡†æ¶ï¼Œä½¿ç”¨å¼‚æ­¥å‡½æ•°å¤„ç†ä¸­é—´ä»¶ï¼Œæä¾›äº†ç®€æ´è€Œå¼ºå¤§çš„Webå¼€å‘ä½“éªŒã€‚
*   **MySQL**: MySQLæ˜¯ä¸€ä¸ªæµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå…·æœ‰é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¹¿æ³›çš„åº”ç”¨é¢†åŸŸï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡çš„åº”ç”¨ç¨‹åºã€‚

## æˆ‘çš„å¾…åŠ

å¿«é€Ÿæ·»åŠ å¾…åŠä»»åŠ¡ï¼Œå¿«é€ŸæŸ¥çœ‹ä»»åŠ¡è¿›åº¦ï¼Œæ‘˜è¦ç­‰ã€‚æ–°å¢æ ‡ç­¾ï¼Œåˆ†ç±»ï¼Œæ›´å¥½ç®¡ç†å¾…åŠä»»åŠ¡ã€‚é€šè¿‡æ ‡ç­¾ã€åˆ†ç±»ç­›é€‰å¾…åŠä»»åŠ¡ï¼Œæ–¹ä¾¿å¿«æ·ã€‚

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/6c4381b677d74783af71a81af662c6c5~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=%2B%2BlwwA%2BeQ8nRVrNsbsBtfgMrMgs%3D)

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/4c5f85d31f9345d581336102ebd413a1~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=YX2vN4vtdz1oO%2FAMfhlzuivNP%2Bk%3D)

## OKRç›®æ ‡ç®¡ç†

æˆ‘çš„æƒ³æ³•æ˜¯é€šè¿‡OKRç®¡ç†ç³»åˆ—çš„ä»»åŠ¡ï¼Œè¿™æ ·æ¯å®Œæˆä¸€ä¸ªå°ä»»åŠ¡ï¼Œå°±å¯ä»¥å…³é—­ä¸€ä¸ªå°ä»»åŠ¡ï¼Œç›´è§‚åˆæ–¹ä¾¿ï¼Œç­‰åˆ°æ‰€æœ‰å…³é”®çš„å°ä»»åŠ¡éƒ½å®Œæˆäº†ï¼Œæ•´ä¸ªä»»åŠ¡ä¹Ÿå°±å®Œæˆäº†ã€‚

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/efe7fbc1bd48491eb0091d2fa8d3374f~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=WwT5P5V9LCBQTXBuY5Eqe5KIkcs%3D)

## ç•ªèŒ„å·¥ä½œæ³•

ä¸»è¦æ˜¯ä¸€ä¸ªè®¡æ—¶çš„æ—¶é’Ÿï¼Œå¯ä»¥åœ¨ä¸“æ³¨è®¡æ—¶çš„æ—¶å€™ï¼Œä¸“æ³¨åœ°å®ŒæˆæŸé¡¹ä»»åŠ¡ï¼Œå¿«æ·æ–¹ä¾¿ï¼Œä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•ï¼Œé€‰æ‹©ä¸€ä¸ªå¾…å®Œæˆçš„ä»»åŠ¡ï¼Œå°†ç•ªèŒ„æ—¶é—´è®¾ä¸º25åˆ†é’Ÿï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–çš„åŒºé—´ï¼Œä¸“æ³¨å·¥ä½œï¼Œä¸­é€”ä¸å…è®¸åšä»»ä½•ä¸è¯¥ä»»åŠ¡æ— å…³çš„äº‹ã€‚æ—¶åˆ»ä¿æŒä¸“æ³¨ã€‚

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/5a9cc62780ca4d2d9d3695207291e0a8~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=NxLlTj53%2FzAky7%2BiE2cHKEnO0gY%3D)

## æ—¥å†è§†å›¾

æ‰“å¼€æ—¥å†ç•Œé¢,é€šè¿‡è§†å›¾çš„å½¢å¼æŸ¥çœ‹å…¬å†æˆ–å†œå†æ—¥å†ä¸‹æ¯ä¸ªæ—¥æœŸçš„å¾…åŠæé†’æˆ–ä»»åŠ¡äº‹é¡¹ã€‚ä¹Ÿå¯ä»¥åœ¨æ—¥å†è§†å›¾ï¼Œæ·»åŠ ä»»åŠ¡ã€‚

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/6457aa4f3580439d91f967bed1d7fea2~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=gVZhGArunPBIrUHwh76XSmteW7Q%3D)

## MEMOå¿«é€Ÿè®°å½•

ä¸ºäº†æ›´å¥½åœ°å¸®ä½ æ•æ‰æƒ³æ³•ä¸çµæ„Ÿï¼Œæä¾›äº†å¿«é€Ÿè®°å½•çš„è¾“å…¥æ¡†ã€‚ä¸“æ³¨è®°å½•æƒ³æ³•ï¼Œæ— éœ€æ€è€ƒæ ‡é¢˜å’Œæ’ç‰ˆã€‚æ§åˆ¶è®°å½•é•¿åº¦ï¼Œé™ä½è®°å½•å‹åŠ›ï¼Œå¿«é€Ÿæ•æ‰ã€‚

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/78e6a240c6d742c191ffa746a4d1fce9~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=RfY86pptYDfJndPfgKH8FRGLE9E%3D)

## ç»Ÿè®¡åŠŸèƒ½

å±•ç¤ºäº†æ¯å¤©çš„å¾…åŠæ•°ï¼Œä»¥åŠæ¯å¤©æ–°å¢çš„å¾…åŠæ•°é‡ã€‚

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/57c9bb54167d41b0be4e8cd5e2798611~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=xkUm%2Ft6DO977bGlJEWhqsSQtHxA%3D)

# å±•ç¤ºåŠŸèƒ½ç‚¹

## æ‰“åŒ…å‘å¸ƒç‰ˆæœ¬

è„šæœ¬å‘½ä»¤

```js
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "tauri": "tauri",
    "pub": "cd build && node ./updateVersion.js && pnpm tauri build && node ./publish.js"
  }
```

```js
npm run pub
```

## æ›´æ–°ç‰ˆæœ¬å·ä»¥åŠæ›´æ–°publicKey

```js
//build/publish.js
import fs from 'fs'
// è¯»å– tauri.conf.json
const tauriConf = JSON.parse(fs.readFileSync('../src-tauri/tauri.conf.json', 'utf8'));
let newVersion = tauriConf.package.version; //æ›´æ–°çš„ç‰ˆæœ¬å·

// è¯»å– update.json
let updateJson = JSON.parse(fs.readFileSync('update.json', 'utf8'));
// æ›´æ–° update.json version
updateJson.version = newVersion;

//è·å–ç‰ˆæœ¬æ›´æ–°çš„å†…å®¹
//ç­¾åã€ç‰ˆæœ¬è·¯å¾„ã€å‘ç‰ˆæ—¥æœŸ
const signature =  fs.readFileSync(`../src-tauri/target/release/bundle/msi/kestrel-task_${newVersion}_x64_zh-CN.msi.zip.sig`, 'utf8');
updateJson.platforms['windows-x86_64'].signature = signature;
updateJson.platforms['windows-x86_64'].url = `https://kestrel-task.cn/kestrel-task_${newVersion}_x64_zh-CN.msi.zip`
updateJson.pub_date = new Date();
fs.writeFileSync('update.json', JSON.stringify(updateJson, null, 2));
```

## ç‰ˆæœ¬jsonä¿¡æ¯

```js
//build/update.json

{
  "version": "1.0.8",
  "notes": "kestrel-task",
  "pub_date": "2024-03-23T04:23:39.799Z",
  "platforms": {
    "windows-x86_64": {
      "signature": "dW50cnVzdGVkIGNvbW1lbnQ6IHNpZ25hdHVyZSBmcm9tIHRhdXJpIHNlY3JldCBrZXkKUlVSNVRCUit5Zjc1Y3JLV085djl6eTMza2NqMXFIV0paNkl2ckgrTGZTRm9wcEJwcUlkaTBhM2hvN3pSVkRUZXlTZ2NSejJremg2Vklja041VkZmdGlZZ0hxTGVVM2xlL3dFPQp0cnVzdGVkIGNvbW1lbnQ6IHRpbWVzdGFtcDoxNzExMTY3ODE5CWZpbGU6a2VzdHJlbC10YXNrXzEuMC44X3g2NF96aC1DTi5tc2kuemlwCldSWVdwb0dwRU1aQUJ2ckFra2FTMjBkcnZtL0FWU3grd3MzeHZVTDhWRFFFUC9QWkpzdUNvUG9HZXBrVmhWMkoxTkpGc2pkYU5rRHYwcVdHdlk5dkFBPT0K",
      "url": "https://kestrel-task.cn/kestrel-task_1.0.8_x64_zh-CN.msi.zip"
    }
  }
}

```

## æ›´æ–°tauri.conf.jsonç‰ˆæœ¬ä¿¡æ¯

```js
// build/updateVersion.js
import fs from 'fs' // è¯»å– tauri.conf.json
const tauriConf = JSON.parse(fs.readFileSync('../src-tauri/tauri.conf.json', 'utf8'));
let version = tauriConf.package.version; //æ›´æ–°çš„ç‰ˆæœ¬å·

//æ›´æ–°ç‰ˆæœ¬å·
let versionParts = version.split('.').map(Number);
versionParts[2] += 1;
let newVersion =versionParts.join('.');
// æ›´æ–° tauri.conf.json version
tauriConf.package.version = newVersion;
fs.writeFileSync('../src-tauri/tauri.conf.json', JSON.stringify(tauriConf, null, 2));
```

## ä½¿ç”¨tauriçš„httpæ¨¡å—

æ­¤å¤„è¿›è¡Œç®€å•çš„å°è£…ï¼Œæ¥å£è¯·æ±‚åœ¨æ§åˆ¶å°æ— æ³•è¢«æŸ¥çœ‹åˆ°ã€‚å¦‚æœè§‰å¾—ä¸æ–¹ä¾¿ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨axiosåº“ã€‚ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

```js
import { http } from "@tauri-apps/api";

export function request(config) {
  return new Promise((resolve, reject) => {
    http
      .fetch("https://kestrel-task.cn" + config.url, {
        method: "POST",
        body: http.Body.json(config.data),
        headers: {
          Authorization: token,
        },
      })
      .then((res) => {
        resolve(res.data.data);
      })
      .catch((err) => {
        reject(err);
      });
  });
}

```

## httpå°è£…getè¯·æ±‚

```js
export function requestGet(config, d) {
  let url = d ? config.url : "https://kestrel-task.cn" + config.url;
  return new Promise((resolve, reject) => {
    http
      .fetch(url, {
        method: "get",
        headers: {
          Authorization: token,
        },
      })
      .then((res) => {
        resolve(d ? res.data : res.data.data);
      })
      .catch((err) => {
        reject(err);
      });
  });
}

```

## ä½¿ç”¨å°è£…çš„requestå‡½æ•°

```js
export const login = (data) => {
  return request({
    url: "/web/login",
    method: "post",
    data,
  });
};
```

## ä½¿ç”¨WebviewWindowå°è£…å…¬å…±çš„çª—å£

```js
import { WebviewWindow } from '@tauri-apps/api/window'
import { emit } from '@tauri-apps/api/event'

// åˆ›å»ºæ–°çª—å£
export async function createWin(args) {
    await emit('win-create', args)
}

// è·å–çª—å£
export async function getWin(label) {
    return await WebviewWindow.getByLabel(label)
}

/**
 * @desc è®¾ç½®çª—å£
 * @param type {string} 'show'|'hide'|'close'|'min'|'max'|'max2min'|'exit'|'relaunch'
 */
export async function setWin(type) {
    await emit('win-' + type)
}

// ç™»å½•çª—å£
export async function loginWin() {
    await createWin({
        label: 'Login',
        title: 'ç™»å½•',
        url: '/login',
        width: 320,
        height: 420,
        resizable: false,
        alwaysOnTop: true,
    })
}

// ...
```

```js
/**
 * @desc    å°è£…æ–°å¼€å¤šçª—ä½“
 */

import {
  WebviewWindow,
  appWindow,
  getAll,
  getCurrent,
} from "@tauri-apps/api/window";
import { relaunch, exit } from "@tauri-apps/api/process";
import { emit, listen } from "@tauri-apps/api/event";

import { setWin } from "./actions.js";

// ç³»ç»Ÿå‚æ•°é…ç½®
export const windowConfig = {
  label: null, // çª—å£å”¯ä¸€label
  title: "", // çª—å£æ ‡é¢˜
  url: "", // è·¯ç”±åœ°å€url
  width: 900, // çª—å£å®½åº¦
  height: 640, // çª—å£é«˜åº¦
  minWidth: null, // çª—å£æœ€å°å®½åº¦
  minHeight: null, // çª—å£æœ€å°é«˜åº¦
  x: null, // çª—å£ç›¸å¯¹äºå±å¹•å·¦ä¾§åæ ‡
  y: null, // çª—å£ç›¸å¯¹äºå±å¹•é¡¶ç«¯åæ ‡
  center: true, // çª—å£å±…ä¸­æ˜¾ç¤º
  resizable: true, // æ˜¯å¦æ”¯æŒç¼©æ”¾
  maximized: false, // æœ€å¤§åŒ–çª—å£
  decorations: true, // çª—å£æ˜¯å¦æ— è¾¹æ¡†åŠå¯¼èˆªæ¡
  alwaysOnTop: false, // ç½®é¡¶çª—å£
};

class Windows {
  constructor() {
    this.mainWin = null;
  }

  // è·å–çª—å£
  getWin(label) {
    return WebviewWindow.getByLabel(label);
  }

  // è·å–å…¨éƒ¨çª—å£
  getAllWin() {
    return getAll();
  }

  // åˆ›å»ºæ–°çª—å£
  async createWin(options) {
    const args = Object.assign({}, windowConfig, options);

    // åˆ¤æ–­çª—å£æ˜¯å¦å­˜åœ¨
    const existWin = getAll().find((w) => w.label == args.label);
    if (existWin) {
      if (existWin.label.indexOf("main") == -1) {
        await existWin?.unminimize();
        await existWin?.setFocus();
        return;
      }
      await existWin?.close();
    }

    // åˆ›å»ºçª—å£å¯¹è±¡
    let win = new WebviewWindow(args.label, args);

    // æ˜¯å¦æœ€å¤§åŒ–
    if (args.maximized && args.resizable) {
      win.maximize();
    }

    // çª—å£åˆ›å»ºå®Œæ¯•/å¤±è´¥
    win.once("tauri://created", async () => {
      console.log("window create success!");
    });

    win.once("tauri://error", async () => {
      console.log("window create error!");
    });
  }

  // å¼€å¯ä¸»è¿›ç¨‹ç›‘å¬äº‹ä»¶
  async listen() {
    // åˆ›å»ºæ–°çª—ä½“
    await listen("win-create", (event) => {
      this.createWin(JSON.parse(event.payload));
    });

    // æ˜¾ç¤ºçª—ä½“
    await listen("win-show", async (event) => {
      if (appWindow.label.indexOf("main") == -1) return;
      await appWindow.show();
      await appWindow.unminimize();
      await appWindow.setFocus();
    });

    // éšè—çª—ä½“
    await listen("win-hide", async (event) => {
      if (appWindow.label.indexOf("main") == -1) return;
      await appWindow.hide();
    });

    // é€€å‡ºåº”ç”¨
    await listen("win-exit", async (event) => {
      setWin("logout");
      await exit();
    });

    // é‡å¯åº”ç”¨
    await listen("win-relaunch", async (event) => {
      await relaunch();
    });

    // ä¸»/æ¸²æŸ“è¿›ç¨‹ä¼ å‚
    await listen("win-setdata", async (event) => {
      await emit("win-postdata", JSON.parse(event.payload));
    });
  }
}

export default Windows;

```

## å°è£…Echartç»„ä»¶ï¼Œä¾¿äºä½¿ç”¨

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/c58317a1cff24d27a5a4f4bfd69556bb~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=WHILRxvviLoW2uizwYre9kDcXyw%3D)

```js
<template>
    <div ref="MyEcharts" :style="{ height: height, width: width }"></div>
  </template>
  
  <script>
  import * as echarts from 'echarts'
  import T from './echarts-theme-T.js'
  echarts.registerTheme('T', T)
  const unwarp = obj => obj && (obj.__v_raw || obj.valueOf() || obj)
  export default {
      ...echarts,
      name: 'Charts',
      props: {
          // é«˜åº¦
          height: { type: String, default: '100%' },
          // å®½åº¦
          width: { type: String, default: '100%' },
          // æ˜¯å¦æ— æ•°æ®
          nodata: { type: Boolean, default: false },
          // é…ç½®é¡¹
          option: { type: Object, default: () => {} }
      },
      data() {
          return {
              isActivat: false,
              myChart: null,
              MyEcharts:null
          }
      },
      watch: {
          option: {
              deep: true,
              handler(v) {
                  unwarp(this.myChart).setOption(v)
              }
          }
      },
      computed: {
          myOptions: function() {
              return this.option || {}
          }
      },
      activated() {
          if (!this.isActivat) {
              this.$nextTick(() => {
                  this.myChart.resize()
              })
          }
      },
      deactivated() {
          this.isActivat = false
      },
      mounted() {
          this.isActivat = true
          this.$nextTick(() => {
              this.draw()
          })
      },
      methods: {
          draw() {
              const myChart = echarts.init(this.$refs.MyEcharts, 'T')
              myChart.setOption(this.myOptions)
              this.myChart = myChart
              window.addEventListener('resize', () => myChart.resize())
          }
      }
  }
  </script>
```

## echartä¸»é¢˜æ¨¡å—

```js
//echarts-theme-T.js
const T = {
    color: ['#409EFF', '#36CE9E', '#f56e6a', '#626c91', '#edb00d', '#909399'], // é¢œè‰²æ•°ç»„
    grid: { // ç½‘æ ¼
        left: '3%', // å·¦è¾¹è·
        right: '3%', // å³è¾¹è·
        bottom: '10', // ä¸‹è¾¹è·
        top: '40', // ä¸Šè¾¹è·
        containLabel: true // åŒ…å«æ ‡ç­¾
    },
    legend: { // å›¾ä¾‹
        textStyle: { // æ–‡æœ¬æ ·å¼
            color: '#999' // é¢œè‰²
        },
        inactiveColor: 'rgba(128,128,128,0.4)' // ä¸æ´»è·ƒé¢œè‰²
    },
    categoryAxis: { // ç±»åˆ«è½´
        axisLine: { // è½´çº¿
            show: true, // æ˜¾ç¤º
            lineStyle: { // çº¿æ¡æ ·å¼
                color: 'rgba(128,128,128,0.2)', // é¢œè‰²
                width: 1 // å®½åº¦
            }
        },
        axisTick: { // åˆ»åº¦çº¿
            show: false, // ä¸æ˜¾ç¤º
            lineStyle: { // çº¿æ¡æ ·å¼
                color: '#000' // é¢œè‰²
            }
        },
        axisLabel: { // è½´æ ‡ç­¾
            color: '#999' // é¢œè‰²
        },
        splitLine: { // åˆ†éš”çº¿
            show: false, // ä¸æ˜¾ç¤º
            lineStyle: { // çº¿æ¡æ ·å¼
                color: ['#eee'] // é¢œè‰²
            }
        },
        splitArea: { // åˆ†éš”åŒºåŸŸ
            show: false, // ä¸æ˜¾ç¤º
            areaStyle: { // åŒºåŸŸæ ·å¼
                color: ['rgba(255,255,255,0.01)', 'rgba(0,0,0,0.01)'] // é¢œè‰²
            }
        }
    },
    valueAxis: { // æ•°å€¼è½´
        axisLine: { // è½´çº¿
            show: false, // ä¸æ˜¾ç¤º
            lineStyle: { // çº¿æ¡æ ·å¼
                color: '#999' // é¢œè‰²
            }
        },
        splitLine: { // åˆ†éš”çº¿
            show: true, // æ˜¾ç¤º
            lineStyle: { // çº¿æ¡æ ·å¼
                color: 'rgba(128,128,128,0.2)' // é¢œè‰²
            }
        }
    }
}

export default T
```

## å°è£…å…¬å…±çš„å¼¹çª—ç»„ä»¶

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/b90b6962ec454c8c83239e4ee7df1557~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=nXWLhLDbktFgdYhfpUx0isqadcI%3D)

```js
<template>
  <el-dialog class="my-dialog" draggable v-bind="$attrs" v-model="modelValue" :modal-append-to-body="modalAppendToBody"
    :append-to-body="appendToBody" :fullscreen="fullscreen" :close-on-click-modal="closeOnClickModal"
    :close-on-press-escape="closeOnPressEscape" :width="comWidth" :top="top" @closed="closed">
    <template v-slot:title>
      <slot name="title">
        <span class="my-dialog-title">{{ dialogTitle || ''}}</span>
      </slot>
    </template>
    <div v-loading="loading" class="body-content" :style="{'height':comHeight}">
      <slot></slot>
    </div>
    <template #footer>
      <div class="dialog-footer" v-if="closeBtn">
        <el-button type="close" size="small1" @click="closed">å…³é—­</el-button>
      </div>
    </template>
  </el-dialog>
</template>
<script setup>
import { computed } from 'vue'
const props = defineProps(
  {
    visible: { type: Boolean, default: false }, // æ˜¯å¦å¯è§
    loading: { type: Boolean, default: false }, // æ˜¯å¦åŠ è½½ä¸­
    top: { type: String, default: '20vh' }, // è·ç¦»é¡¶éƒ¨çš„è·ç¦»
    fullscreen: { type: Boolean, default: false }, // æ˜¯å¦å…¨å±
    size: { type: String, default: 'big' }, // å¤§å°
    width: { type: [Number, String], default: 0 }, // å®½åº¦
    height: { type: [Number, String], default: '55vh' }, // å®½åº¦
    dialogTitle: { type: String, default: '' }, // å¼¹å‡ºæ¡†æ ‡é¢˜
    modalAppendToBody: { type: Boolean, default: false }, // æ˜¯å¦å°†å¼¹å‡ºæ¡†æ’å…¥åˆ°bodyä¸­
    appendToBody: { type: Boolean, default: false }, // æ˜¯å¦å°†å†…å®¹æ’å…¥åˆ°bodyä¸­
    closeOnClickModal: { type: Boolean, default: false }, // æ˜¯å¦åœ¨ç‚¹å‡»æ¨¡æ€æ¡†æ—¶å…³é—­
    closeOnPressEscape: { type: Boolean, default: false }, // æ˜¯å¦åœ¨æŒ‰ä¸‹ESCé”®æ—¶å…³é—­
    dblclickDisabled: { type: Boolean, default: false }, // æ˜¯å¦ç¦ç”¨åŒå‡»æ”¾å¤§
    closeBtn: { type: Boolean, default: false }, // å…³é—­æŒ‰é’®
  },
  ['modelValue']
)

const comWidth = computed(() => {
  if (props.size === 'small') {
    return props.width || '30%'
  } else if (props.size === 'middle') {
    return props.width || '40%'
  } else if (props.size === 'big') {
    return props.width || '60%'
  }
  return props.width || '40%'
})

const comHeight = computed(() => {
  return props.height || '55vh'
})

const emit = defineEmits(['update:modelValue','closed'])
const closed = () => {
  emit('update:modelValue')
  emit('closed',false)
}
</script>
```

## å°è£…ResizeObserverå‡½æ•°

ä¸»è¦æ˜¯ç›‘å¬å…ƒç´ çš„å˜åŒ–æˆ–è€…çª—å£çš„å˜åŒ–ã€‚æœ‰ä¸€éƒ¨åˆ†ç”¨åˆ°äº†å¯ä»¥æ‹‰ä¼¸çš„å·¦å³å¸ƒå±€çš„æ¨¡å—ã€‚

```js
//directive/index.js
// ç›‘å¬å…ƒç´ å¤§å°å˜åŒ–çš„æŒ‡ä»¤
const map = new WeakMap();
const ob = new ResizeObserver((entries) => {
  for (const entry of entries) {
    // è·å–domå…ƒç´ çš„å›è°ƒ
    const handler = map.get(entry.target);
    //å­˜åœ¨å›è°ƒå‡½æ•°
    if (handler) {
      // å°†ç›‘å¬çš„å€¼ç»™å›è°ƒå‡½æ•°
      handler({
        width: entry.borderBoxSize[0].inlineSize,
        height: entry.borderBoxSize[0].blockSize,
      });
    }
  }
});

export const Resize = {
  mounted(el, binding) {
    //å°†domä¸å›è°ƒçš„å…³ç³»å¡å…¥map
    map.set(el, binding.value);
    //ç›‘å¬elå…ƒç´ çš„å˜åŒ–
    ob.observe(el);
  },
  unmounted(el) {
    //å–æ¶ˆç›‘å¬
    ob.unobserve(el);
  },
};
const directives = { Resize };

const registerDirective = (app) => {
  Object.keys(directives).forEach((key) => {
    app.directive(key, directives[key]);
  });
};
export default registerDirective;

```

## å…¬å…±æ‹–æ›³å¸ƒå±€çš„å‡½æ•°

ä¸»è¦æ˜¯ç”¨äºå·¦å³å¸ƒå±€å®½åº¦çš„å˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨é¼ æ ‡è¿›è¡Œæ‹–æ›³ï¼Œæ”¹å˜å·¦å³ç›’å­çš„é«˜åº¦ã€‚

```js
export const useCommon = ()=>{
    function setLayoutDrag(dragId) {
        const resize = document.getElementById(dragId)
        let previousElement = resize.previousSibling
        let nextElement = resize.nextSibling
        let previousTag = previousElement.tagName
        let nextTag = nextElement.tagName
        resize.onmousedown = (e) => {
          const startX = e.clientX
          const startY = e.clientY
          let type = ''
          if (previousTag === 'ASIDE' && nextTag === 'MAIN') {
            type = 'ASIDE-MAIN'
          } else if (previousTag === 'MAIN' && nextTag === 'ASIDE') {
            type = 'MAIN-ASIDE'
          } else if (
            (previousTag === 'HEADER' && nextTag === 'MAIN') ||
            (previousTag === 'FOOTER' && nextTag === 'MAIN')
          ) {
            type = 'HEADER-MAIN'
          } else if (
            (previousTag === 'MAIN' && nextTag === 'HEADER') ||
            (previousTag === 'MAIN' && nextTag === 'FOOTER')
          ) {
            type = 'MAIN-HEADER'
          }
          let initWidth = 0,
            initHeight = 0
          if (type === 'ASIDE-MAIN') {
            initWidth = previousElement.clientWidth // åˆå§‹ä½ç½®
          } else if (type === 'MAIN-ASIDE') {
            initWidth = nextElement.clientWidth // åˆå§‹ä½ç½®
          } else if (type === 'HEADER-MAIN') {
            initHeight = previousElement.clientHeight
          } else if (type === 'MAIN-HEADER') {
            initHeight = nextElement.clientHeight
          }
          document.onmousemove = (k) => {
            const endX = k.clientX
            const endY = k.clientY
            let moveLen = endX - startX // æ¨ªå‘ç§»åŠ¨å®½åº¦
            let moveHeight = endY - startY // çºµå‘ç§»åŠ¨é«˜åº¦
            switch (type) {
              case 'ASIDE-MAIN':
                let asideMainWidth = initWidth + moveLen
                if (moveLen < 0) {
                  // å‘å·¦ç§»
                  if (asideMainWidth > 400) {
                    // å·¦ä¾§å‰©90
                    previousElement.style.width = asideMainWidth + 'px'
                  }
                } else {
                  // å‘å³ç§»åŠ¨
                  if (nextElement.clientWidth > 400) {
                    // å³ä¾§å‰©90
                    previousElement.style.width = asideMainWidth + 'px'
                  }
                }
                break
              case 'MAIN-ASIDE':
                let mainAsideWidth = initWidth - moveLen
                if (moveLen < 0) {
                  // å‘å·¦ç§»
                  if (previousElement.clientWidth > 400) {
                    // å·¦ä¾§å‰©90
                    nextElement.style.width = mainAsideWidth + 'px'
                  }
                } else {
                  // å‘å³ç§»åŠ¨
                  if (mainAsideWidth > 400) {
                    nextElement.style.width = mainAsideWidth + 'px'
                  }
                }
                break
              case 'HEADER-MAIN': {
                let headerMainHeight = initHeight + moveHeight
                if (moveHeight < 0) {
                  // å‘ä¸Šç§»
                  if (headerMainHeight > 60) {
                    // ä¸Šä¾§å‰©90
                    previousElement.style.height = headerMainHeight + 'px'
                  }
                } else {
                  // å‘ä¸‹ç§»åŠ¨
                  if (nextElement.clientHeight > 60) {
                    // ä¸‹ä¾§å‰©90
                    previousElement.style.height = headerMainHeight + 'px'
                  }
                }
                break
              }
              case 'MAIN-HEADER': {
                let mainHeaderHeight = initHeight - moveHeight
                if (moveHeight < 0) {
                  // å‘ä¸Šç§»
                  if (previousElement.clientHeight > 60) {
                    // å·¦ä¾§å‰©90
                    nextElement.style.height = mainHeaderHeight + 'px'
                  }
                } else {
                  // å‘ä¸‹ç§»åŠ¨
                  if (mainHeaderHeight > 60) {
                    nextElement.style.height = mainHeaderHeight + 'px'
                  }
                }
                break
              }
      
              default:
            }
          }
          document.onmouseup = (evt) => {
            document.onmousemove = null
            document.onmouseup = null
            resize.releaseCapture && resize.releaseCapture()
          }
          resize.setCapture && resize.setCapture()
          return false
        }
      }

      return {
        setLayoutDrag
      }
}
```

## å…¬å…±å¸ƒå±€

æ­¤å¤„çš„å¯ä»¥è‡ªå·±æŸ¥çœ‹ä»£ç ã€‚

![](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/a1ed96f041ad4bbf8a4f75e9b19ab10b~tplv-73owjymdk6-watermark.image?policy=eyJ2bSI6MywidWlkIjoiMzcwMjgxMDg5NDE1MzU5MiJ9&rk3s=f64ab15b&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722473182&x-orig-sign=ua2Rl2MdqQEcygu9%2FmvC3dzEeKI%3D)

## invokeè°ƒç”¨rustå‡½æ•°ï¼Œå…³é—­splash

```js
import { invoke } from '@tauri-apps/api/tauri'

onMounted(() => {
  // window.addEventListener('contextmenu', (e) => e.preventDefault(), false)
  document.addEventListener('DOMContentLoaded', () => {
    // This will wait for the window to load, but you could
    // run this function on whatever trigger you want
    setTimeout(() => {
      invoke('close_splashscreen')
    }, 1000)
  })
})
```

ğŸ‰ä½¿ç”¨Tauri+vite+koa2+mysqlå¼€å‘äº†ä¸€æ¬¾å¾…åŠæ•ˆç‡åº”ç”¨

## ğŸ“é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºtauri+viteçš„åº”ç”¨ï¼Œå®ƒé‡‡ç”¨äº†ä¸€äº›æœ€æ–°çš„å‰ç«¯æŠ€æœ¯ï¼ŒåŒ…æ‹¬ Tauriã€Vue3ã€Vite5ã€koa2 å’Œ mysqlã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„æ•ˆç‡ç®¡ç†å·¥å…·ã€‚

åº”ç”¨åœ°å€ï¼š<https://kestrel-task.cn>

å–œæ¬¢çš„å¯ä»¥è¯•è¯•å“¦ï¼ŒğŸ™ğŸ™ğŸ™

## ğŸ†é¡¹ç›®é¢„è§ˆ

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21aec3d72f864d88b207f678a0b04517~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100\&h=631\&s=48644\&e=png\&b=fdfdfd)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d786d19a4cdb40d5855ae54d4a904f25~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100\&h=680\&s=66330\&e=png\&b=fdf2f1)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/638ac319810547f7ad589554a3991ff1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100\&h=680\&s=68763\&e=png\&b=fdf0ee)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee5d7dde28f74ff08abc209ee619a9a2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100\&h=680\&s=48007\&e=png\&b=fefefe)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b25a5c46c424b08978ae5683b5d5677~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100\&h=680\&s=77110\&e=png\&b=fdf2eb)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2e15a6cfd6b420d9024530486228804~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100\&h=680\&s=87965\&e=png\&b=8d8784)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e479faa9c1314a2e9a4430bb000cd443~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100\&h=702\&s=68312\&e=png\&b=fefefe)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fef428b0f92346b1af6091610240c586~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100\&h=702\&s=65271\&e=png\&b=fefdfd)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9ff347653d243f08161df8e15e3cbf5~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100\&h=717\&s=65095\&e=png\&b=fdfdfd)

## ğŸ’»æŠ€æœ¯æ ˆ

*   **Tauri**: Tauriæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç°ä»£æ¡Œé¢åº”ç”¨ç¨‹åºçš„å·¥å…·ï¼Œç»“åˆäº†Rustã€Vue.jså’ŒWebæŠ€æœ¯ï¼Œæä¾›äº†å¼ºå¤§çš„è·¨å¹³å°èƒ½åŠ›ã€‚
*   **Vue3**: Vue3æ˜¯æµè¡Œçš„JavaScriptæ¡†æ¶Vue.jsçš„æœ€æ–°ç‰ˆæœ¬ï¼Œå…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€æ›´å¥½çš„TypeScriptæ”¯æŒå’Œæ›´å¤šçš„ç‰¹æ€§ã€‚
*   **Vite5**: Viteæ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ„å»ºå·¥å…·ï¼ŒVite5æ˜¯å…¶æœ€æ–°ç‰ˆæœ¬ï¼Œå…·æœ‰å¿«é€Ÿçš„å†·å¯åŠ¨ã€çƒ­æ¨¡å—æ›¿æ¢å’ŒåŸç”ŸESæ¨¡å—æ”¯æŒã€‚
*   **Koa2**: Koa2æ˜¯ä¸€ä¸ªåŸºäºNode.jsçš„è½»é‡çº§Webæ¡†æ¶ï¼Œä½¿ç”¨å¼‚æ­¥å‡½æ•°å¤„ç†ä¸­é—´ä»¶ï¼Œæä¾›äº†ç®€æ´è€Œå¼ºå¤§çš„Webå¼€å‘ä½“éªŒã€‚
*   **MySQL**: MySQLæ˜¯ä¸€ä¸ªæµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå…·æœ‰é«˜æ€§èƒ½ã€å¯é æ€§å’Œå¹¿æ³›çš„åº”ç”¨é¢†åŸŸï¼Œé€‚ç”¨äºå„ç§è§„æ¨¡çš„åº”ç”¨ç¨‹åºã€‚

ä¸»è¦åŒ…æ‹¬çš„åŠŸèƒ½ç‚¹å®ç°

## ğŸ””å›¾æ ‡ç”Ÿæˆ

åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œæ”¾ä¸Šå›¾ç‰‡ä¸º app-icon.pngçš„å›¾ç‰‡
ç„¶åæ‰§è¡Œã€‚å°±èƒ½çœ‹åˆ°å›¾æ ‡å·²ç»ç”Ÿæˆäº†ã€‚

```json
npm run tauri icon
```

## ğŸ“¢é…ç½®åº”ç”¨ç³»ç»Ÿæ‰˜ç›˜

### æ–°å»ºtray.rs,ç¼–å†™æ‰˜ç›˜äº‹ä»¶ã€‚å†…å®¹å¦‚ä¸‹ã€‚

```rust
use tauri::{
    AppHandle, CustomMenuItem, SystemTray, SystemTrayEvent, SystemTrayMenu, SystemTrayMenuItem
};
use tauri::Manager;

// æ‰˜ç›˜èœå•
pub fn menu() -> SystemTray {
    let quit = CustomMenuItem::new("quit".to_string(), "é€€å‡º");
    let show = CustomMenuItem::new("show".to_string(), "æ˜¾ç¤º");
    let hide = CustomMenuItem::new("hide".to_string(), "éšè—");
    let tray_menu = SystemTrayMenu::new()
        .add_native_item(SystemTrayMenuItem::Separator)
        .add_item(hide)
        .add_item(show)
        .add_native_item(SystemTrayMenuItem::Separator)
        .add_item(quit);

    SystemTray::new().with_menu(tray_menu)
}

// æ‰˜ç›˜äº‹ä»¶
pub fn handler(app: &AppHandle, event: SystemTrayEvent) {
    let window = app.get_window("main").unwrap();
    match event {
        SystemTrayEvent::MenuItemClick { id, .. } => match id.as_str() {
            "quit" => {
                std::process::exit(0);
            }
            "show" => {
                window.show().unwrap();
            }
            "hide" => {
                window.hide().unwrap();
            }
            _ => {}
        },
        _ => {}
    }
}

```

### åœ¨main.rsä¸­ä½¿ç”¨

```rust
use std::{thread,time};
mod tray;

fn main() {
    let context = tauri::generate_context!();
    tauri::Builder::default()
        // .menu(tauri::Menu::os_default(&context.package_info().name)) //é…ç½®ç•Œé¢èœå•
        .system_tray(tray::menu()) // âœ… å°† `tauri.conf.json` ä¸Šé…ç½®çš„å›¾æ ‡æ·»åŠ åˆ°ç³»ç»Ÿæ‰˜ç›˜
        .on_system_tray_event(tray::handler) // âœ… æ³¨å†Œç³»ç»Ÿæ‰˜ç›˜äº‹ä»¶å¤„ç†ç¨‹åº
        .invoke_handler(tauri::generate_handler![my_custom_command, init_process,close_splashscreen])
        .run(context)
        .expect("error while running tauri application");
}
```

## ğŸ›ï¸ æ¥å£å°è£…è¯·æ±‚

Tauri æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒå…è®¸å¼€å‘è€…ä½¿ç”¨ Rust è¯­è¨€æ¥æ„å»ºè½»é‡çº§çš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼ŒTauri æä¾›äº†ä¸€å¥— APIï¼Œå…¶ä¸­åŒ…æ‹¬äº†ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ http æ¨¡å—ã€‚
tauri.conf.json æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼š

```json
{
  "tauri": {
    "allowlist": {
      "http": {
        "all": true,
        "request": true,
        "scope":[
          "http://**",
          "https://**"
        ]
      }
    }
  }
}
```

## ğŸµåŸºäºAPIçš„å°è£…

```js
// http.js

import { fetch, ResponseType, Body } from '@tauri-apps/api/http'

// https://tauri.app/zh-cn/v1/api/js/http#fetch
export const http = (opts = {}) => {
  return new Promise((resolve, reject) => {
    const { url, method, query, data, headers, callback } = opts
    fetch(url, {
      method: method || 'GET',
      headers: {
        'content-type': 'application/json',
        ...headers,
      },
      responseType: ResponseType.JSON,
      timeout: 60000,
      query: query,
      body: Body.json({
        ...data,
      }),
    })
    .then((res) => {
      callback && callback(res)
      resolve(res)
    })
    .catch((e) => {
      reject(e)
    })
  })
}
```

## ğŸ˜„è·å–ç‰ˆæœ¬å·

è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨äºè·å–åº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯

```js
import { getVersion } from '@tauri-apps/api/app'
```

```js
onMounted(async () => {
  appVersion.value = await getVersion()
  getNewVersions()
})
```

## ğŸ™‚æ£€æŸ¥ç‰ˆæœ¬æ›´æ–°

è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å¯¼å…¥ Tauri ä¸­çš„æ›´æ–°æ¨¡å— @tauri-apps/api/updater ä¸­çš„ checkUpdate å’Œ installUpdate å‡½æ•°ã€‚checkUpdate ç”¨äºæ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„åº”ç”¨ç¨‹åºæ›´æ–°ï¼Œè€Œ installUpdate ç”¨äºå®‰è£…åº”ç”¨ç¨‹åºæ›´æ–°ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/756ee30143e049faabe7ce0d322b3126~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1037\&h=591\&s=98618\&e=png\&b=8c8584)

```js
import { checkUpdate, installUpdate } from '@tauri-apps/api/updater'
```

```js
  checkUpdate().then(async (res) => {
    const { shouldUpdate, manifest } = res
    if (shouldUpdate) {
      confirm(`å‘ç°æ–°ç‰ˆæœ¬ï¼š${manifest?.version}ï¼Œæ˜¯å¦å‡çº§ï¼Ÿ`, { title: 'ç‰ˆæœ¬æ›´æ–°', type: 'success' }).then(async (res) => {
        try {
          ElMessage.success({
            message: 'æ­£åœ¨ä¸‹è½½æ›´æ–°...',
            duration: 3000,
          })
          installUpdate()
            .then(async (res) => {
              await relaunch()
            })
            .catch((e) => {
            })
        } catch (e) {
          ElMessage.error({
            message: 'ä¸‹è½½æ›´æ–°å¤±è´¥',
            description: e.toString() || '',
          })
        }
      })
    } else {
     await confirm(`å½“å‰ç‰ˆæœ¬ï¼Œå·²ç»æ˜¯æœ€æ–°ç‰ˆæœ¬`, { title: 'æ£€æŸ¥æ›´æ–°', type: 'success' ,okLabel: 'ç¡®å®š',cancelLabel: 'å–æ¶ˆ'})
    }
  })
```

## ğŸ™ƒçª—å£æ“ä½œ

çª—å£ç¦ç”¨æœ€å¤§åŒ–å’Œæœ€å°åŒ–åŠŸèƒ½

```json
import { appWindow } from '@tauri-apps/api/window';
```

## ğŸ¥°ç¦ç”¨æœ€å¤§åŒ–å’Œå–æ¶ˆç¦ç”¨

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b0fea5c2cb14c34871a021e33ded335~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1101\&h=643\&s=935785\&e=png\&b=8196e8)

```js
appWindow.setMaximizable(true) //ç¦ç”¨
appWindow.setMaximizable(false) //å–æ¶ˆç¦ç”¨
```

```js
appWindow.setMinimized(true) //ç¦ç”¨
appWindow.setMinimized(false) //å–æ¶ˆç¦ç”¨
```

## ğŸ¥°æ¶ˆæ¯æç¤º

### Askå¼¹çª—

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a6542bed23be430c9e40d7ade9f663fd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=428\&h=204\&s=8338\&e=png\&b=f9f9f9)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/afc34e8aa5734ffab3484f36a411062f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=499\&h=221\&s=12089\&e=png\&b=f9f9f9)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f9cec481b624506a2b43254fd94353e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=499\&h=221\&s=12089\&e=png\&b=f9f9f9)

```js
import { ask } from '@tauri-apps/api/dialog';
const yes = await ask('ç¡®å®šæ›´æ–°è¯¥ç‰ˆæœ¬?', 'å‘ç°æ–°ç‰ˆæœ¬');
const yes2 = await ask('ç¡®å®šæ›´æ–°è¯¥ç‰ˆæœ¬?', { title: 'å‘ç°æ–°ç‰ˆæœ¬', type: 'warning' });
```

å¦‚æœæƒ³è¦ä¿®æ”¹æŒ‰é’®çš„æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨,okLabel: 'ç¡®å®š',cancelLabel: 'å–æ¶ˆ'ã€‚

## ğŸ˜Šconfirmå¼¹çª—

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f0c4c0575394da89365917c1361e717~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=445\&h=175\&s=9331\&e=png\&b=f8f8f8)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31e9903db57949bcb6e4bae01a0d5ecc~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=444\&h=205\&s=11454\&e=png\&b=f8f8f8)

```json
import { confirm } from '@tauri-apps/api/dialog';
const confirmed = await confirm('ç¡®å®šæ›´æ–°è¯¥ç‰ˆæœ¬?', 'å‘ç°æ–°ç‰ˆæœ¬');
const confirmed2 = await confirm('ç¡®å®šæ›´æ–°è¯¥ç‰ˆæœ¬?', { title: 'å‘ç°æ–°ç‰ˆæœ¬', type: 'warning',okLabel: 'ç¡®å®š',cancelLabel: 'å–æ¶ˆ' });
```

## ğŸ˜messageæç¤ºæ¡†

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/73e615ead53946faa2f3f9459202f2d0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=405\&h=153\&s=8463\&e=png\&b=f6f6f6)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32ff141227514934928c346184811397~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=417\&h=164\&s=9159\&e=png\&b=f7f7f7)

```js
import { message } from '@tauri-apps/api/dialog';
await message('ç¡®å®šæ›´æ–°è¯¥ç‰ˆæœ¬', 'å‘ç°æ–°ç‰ˆæœ¬');
await message('ç¡®å®šæ›´æ–°è¯¥ç‰ˆæœ¬', { title: 'å‘ç°æ–°ç‰ˆæœ¬', type: 'error',okLabel: 'ç¡®å®š',cancelLabel: 'å–æ¶ˆ' });
```

## ğŸ¤—open é€‰æ‹©æ–‡ä»¶å¼¹çª—

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8874f30a3ad943f4b584985e984d6eba~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=794\&h=557\&s=46422\&e=png)

```js
import { open } from '@tauri-apps/api/dialog';
// Open a selection dialog for image files
const selected = await open({
  multiple: true,
  filters: [{
    name: 'Image',
    extensions: ['png', 'jpeg']
  }]
});
if (Array.isArray(selected)) {
  // user selected multiple files
} else if (selected === null) {
  // user cancelled the selection
} else {
  // user selected a single file
}
```

## ğŸ˜saveæ–‡ä»¶ä¿å­˜å¼¹çª—

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6048b5853f0547348337e1dcd3df73dc~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=661\&h=571\&s=34662\&e=png\&b=fbfbfb)

```js
import { save } from '@tauri-apps/api/dialog';
const filePath = await save({
  filters: [{
    name: 'Image',
    extensions: ['png', 'jpeg']
  }]
});

```

## ğŸ˜splashscreené¡µè®¾ç½®

ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™ä¸ªå‘¢ï¼Œå› ä¸º`splashscreen` é¡µé¢é€šå¸¸ç”¨äºåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æ˜¾ç¤ºä¸€ä¸ªå¯åŠ¨ç”»é¢æˆ–åŠ è½½åŠ¨ç”»ï¼Œä»¥æä¾›ç”¨æˆ·å‹å¥½çš„ç•Œé¢ä½“éªŒã€‚è¿™ä¸ªé¡µé¢å¯ä»¥åŒ…å«åº”ç”¨ç¨‹åºçš„æ ‡å¿—ã€åç§°æˆ–å…¶ä»–ç›¸å…³ä¿¡æ¯ï¼Œå¸®åŠ©ç”¨æˆ·ç¡®è®¤åº”ç”¨ç¨‹åºæ­£åœ¨åŠ è½½ã€‚ä¸€æ—¦åº”ç”¨ç¨‹åºåŠ è½½å®Œæˆï¼Œé€šå¸¸ä¼šè‡ªåŠ¨å…³é—­ `splashscreen` é¡µé¢å¹¶æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„ä¸»ç•Œé¢ã€‚

#### ğŸ« tauri.conf.jsoné…ç½®

```json
    "windows": [
      {
        "fullscreen": false,
        "resizable": true,
        "title": "å¾®èŠ’è®¡åˆ’",
        "width": 1100,
        "height": 680,
        "minHeight": 600,
        "minWidth": 900,
        "visible": false
      },
      {
        "width": 800,
        "height": 500,
        "minHeight": 500,
        "minWidth": 800,
        "decorations": false,
        "url": "splashscreen.html",
        "label": "splashscreen",
        "resizable": true,
        "fullscreen": false
      }
    ]
```

splashscreen.htmlè¦æ”¾åˆ°publicä¸‹é¢ï¼Œä¸ºä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œé‡Œé¢å¯ä»¥å†™å¼€å±çš„å›¾ç‰‡åŠ¨ç”»æˆ–è€…ç•Œé¢ã€‚

### ğŸ™‚main.rsç¼–å†™å…³é—­splashscreen é¡µé¢çš„åŠŸèƒ½

```rust
// Create the command:
// This command must be async so that it doesn't run on the main thread.
#[tauri::command]
async fn close_splashscreen(window: Window) {
  // Close splashscreen
  window.get_window("splashscreen").expect("no window labeled 'splashscreen' found").close().unwrap();
  // Show main window
  window.get_window("main").expect("no window labeled 'main' found").show().unwrap();
}
```

### ğŸ™ƒmainå…¥å£æä¾›ç»™å‰ç«¯ä½¿ç”¨

```rust
fn main() {
    let context = tauri::generate_context!();
    tauri::Builder::default()
        // .menu(tauri::Menu::os_default(&context.package_info().name)) //é…ç½®ç•Œé¢èœå•
        .system_tray(tray::menu()) // âœ… å°† `tauri.conf.json` ä¸Šé…ç½®çš„å›¾æ ‡æ·»åŠ åˆ°ç³»ç»Ÿæ‰˜ç›˜
        .on_system_tray_event(tray::handler) // âœ… æ³¨å†Œç³»ç»Ÿæ‰˜ç›˜äº‹ä»¶å¤„ç†ç¨‹åº
        .invoke_handler(tauri::generate_handler![my_custom_command, init_process,close_splashscreen])
        .run(context)
        .expect("error while running tauri application");
}
```

### ğŸ™ƒåœ¨å‰ç«¯è°ƒç”¨splashscreené¡µé¢

ç•Œé¢åŠ è½½å®Œæˆåï¼Œå…³æ‰

```rust
import { onMounted } from 'vue'
import { invoke } from '@tauri-apps/api/tauri'
onMounted(() => {
  // window.addEventListener('contextmenu', (e) => e.preventDefault(), false)
  document.addEventListener('DOMContentLoaded', () => {
    // This will wait for the window to load, but you could
    // run this function on whatever trigger you want
    setTimeout(() => {
      invoke('close_splashscreen')
    }, 1000)
  })
})
```

ğŸ‰ç»“è¯­
æ„Ÿå…´è¶£çš„å¯ä»¥è¯•è¯•ï¼Œæœ‰ä¸æ¸…æ¥šçš„é—®é¢˜ï¼Œå…³äºtauriå¼€å‘æ–¹é¢çš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·äº¤æµã€‚æ¬¢è¿åŠ æˆ‘ï¼šzhan\_1337608148ã€‚ä¸€èµ·æˆé•¿ï¼Œä¸€èµ·è¿›æ­¥ã€‚
